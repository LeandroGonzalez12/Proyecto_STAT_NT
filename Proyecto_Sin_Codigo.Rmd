---
title: "Proyecto Final - Nuevas Tecnologias para el Análisis de datos  STAT NT"
author: "Eugenia Bagnasco - Lucas Caram - Federico Colombo - Leandro Gonzalez"
date: "09/07/2021"
output:
  pdf_document: default
  html_document: default
lang: "es"
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# **Introducción**

Debido al virus de la COVID-19, desde principios de 2020 nos encontramos en emergencia sanitaria, la cual ha dejado un elevado número de fallecidos a nivel mundial y ha cambiado completamente nuestras vidas.
En Uruguay, el número de casos positivos y fallecidos ha venido en aumento de forma exponencial desde fines del 2020. Asimismo, en enero 2021 comenzó el plan de vacunación, con el cual se espera dismunir los ingresos a CTI, la cantidad de fallecidos y eventualmente adquirir la inmunidad de rebaño.

En base  a esto, nos vimos interesados en seguir el plan de vacunación en Uruguay, estudiando, por ejemplo, cómo el mismo puede haber influído en los casos positivos, fallecidos, etc. El objetivo del presente trabajo será utilizar los distintos tipos de visualizaciones, resúmenes y funciones aprendidas durante el curso para llevar a cabo el análisis; así como, desarrollar una aplicación Shiny que permita realizar la exploración de forma interactiva.

Para esto, utilizamos 2 conjuntos de datos los cuales están compuestos por varias bases, toda la información es vinculada a datos sobre COVID-19 en Uruguay, como lo son: muertes, casos diarios, vacunados, etc. El horizonte temporal que tendremos en cuenta será el comprendido entre el 1 de Marzo y 23 de Junio del año corriente.

Las fuentes de donde extraímos la informacion fueron: [Proyecto Coronavirus](https://www.gub.uy/ministerio-salud-publica/coronavirus), los
datos del [GUIAD(Grupo Uruguayo Interdisciplinario de Análisis de Datos)](https://guiad-covid.github.io/) y ademas un [repo](https://github.com/3dgiordano/covid-19-uy-vacc-data/blob/main/data/Uruguay.csv) de 3dgiordano.

Antes de poder dar comienzo al análisis exploratorio, limpiamos y reestructuramos algunos datos. De forma que el análisis sea mas claro.

```{r, echo=FALSE,message=FALSE}
library(tidyverse)
library(ggpmisc)
library(here)
```

```{r,echo=FALSE, warning=FALSE,message=FALSE}

uruguay <- read_csv(here("data",'Uruguay.csv')) #Cargamos datos de vacunacion.

# 1 - Dado que los nombres de las variables se encuentran en ingles.
# Se renombran para facilitar la interpretacion.
uruguay <- uruguay %>% rename(diario_coronavac = daily_coronavac,
    acum_coronavac = total_coronavac,primDiario_coronavac = people_coronavac,
    segDiario_coronavac  = fully_coronavac,diario_pfizer = daily_pfizer,
    acum_pfizer = total_pfizer,primDiario_pfizer = people_pfizer,
    segDiario_pfizer = fully_pfizer,diario_astrazeneca = daily_astrazeneca,
    acum_astrazeneca = total_astrazeneca,primDiario_astrazeneca = people_astrazeneca,
    segDiario_astrazeneca = fully_astrazeneca)

# 2 - De "uruguay" anterior, nos interesan en particular ciertas columnas. 
# Tambien se reestructuran datos y cambian nombre de los departamentos.
vacunacion_uru <- uruguay %>% select(-c(1,3:29),-contains("res")) %>% 
  pivot_longer(cols = c(starts_with("total"),starts_with("fully"),starts_with("daily"),
      starts_with("people")),names_to = "departamento",values_to = c("total")) %>% 
      separate(col = departamento,into = c("arranca","depar")) %>% 
      pivot_wider(names_from = arranca,values_from = total) %>% 
      mutate(depar = recode(depar, 'ar'='Artigas', 
                'ca'='Canelones', 'cl'='Cerro Largo', 'co'='Colonia','du'='Durazno',
                'fd'='Florida', 'fs'='Flores', 'la'='Lavalleja', 'ma'='Maldonado',
                'mo'='Montevideo','pa'='Paysandú', 'rn'='Rio Negro','ro'='Rocha',
                'rv'='Rivera','sa'='Salto','sj'='San José','so'='Soriano',
                'ta'='Tacuarembó', 'tt'='Treinta y Tres')) %>% 
      mutate(depar = as.factor(depar))

# 3 - Se crea otro data.frame (total_lab) con los tipos de vacuna 
total_lab <- select(uruguay,date,diario_coronavac,acum_coronavac,primDiario_coronavac,
  segDiario_coronavac,diario_pfizer,acum_pfizer,primDiario_pfizer,segDiario_pfizer,
  diario_astrazeneca,acum_astrazeneca,primDiario_astrazeneca,segDiario_astrazeneca,
  people_vaccinated,people_fully_vaccinated,
  daily_vaccinated,total_vaccinations,daily_agenda,daily_pogress)


# 4 - El conjunto de datos Deaths muestra los datos de fallecimiento segun edad, 
#pero no por departamento, actualizado hasta el dia 22/6
muertes_edad <- read_csv(here("data",'Deaths.csv'))

# 5 - De dichos datos, se eligen las primeras 17 columnas, 
#ya que las otras son tramos distintos de edad.
#Estos tramos son excluyentes y cubren de 0 a 115

muertes_edad <-muertes_edad %>% select(1:17) %>% 
  pivot_longer(cols = c(starts_with("total"),starts_with("daily")),
     names_to = "tramo_etario",values_to = "numeros")
muertes_edad <-muertes_edad %>% separate(col = tramo_etario, 
    into = c("arranca","tramo"),sep = 5)
muertes_edad <-muertes_edad %>% pivot_wider(names_from = arranca,values_from = numeros)
muertes_edad <-muertes_edad %>% mutate(tramo = recode(tramo, '_0_17'  = '[0,17]' , 
   '_18_24'  = '[18,24]' ,'_25_34' = '[25,34]', '_35_44'  = '[35,44]' ,
   '_45_54' = '[45,54]','_55_64'  = '[55,64]' ,'_65_74' = '[65,74]', '_75_115' = '[75,115]')) %>% 
   mutate(tramo_etario = as.factor(tramo)) %>% select(-tramo)

# 6 - Se cargan datos de vacunacion por departamento
departamentos <- read_csv(here("data","Regions.csv"))

# 7 - Se cargan los datos del GUIAD
por_depto <- read_csv(here("data","estadisticasUY_porDepto_detalle.csv"))
nacional  <- read_csv(here("data","estadisticasUY.csv"))

# 8 - Separamos en 2 bases de datos

labs <- total_lab %>% select(date,c(contains("pfizer"),contains("coronavac"),
           contains("astrazeneca")))
total <- total_lab %>% select(-c(contains("pfizer"),contains("coronavac"),
           contains("astrazeneca")))

# 9 - Reestructuramos los datos de laboratorio.
labs <-labs %>%  pivot_longer(cols = c(ends_with("astrazeneca"),ends_with("pfizer"),
                  ends_with("coronavac")),names_to = "laboratorio",values_to = "numeros")
labs <- labs %>% separate(col = laboratorio, into = c("arranca","lab"))
labs <-labs %>% pivot_wider(names_from = arranca,values_from = numeros)
```
\pagebreak

# **Análisis exploratorio**

### Plan de vacunación.

Tal y como planteamos en la introducción, nuestro principal interés se encuentra en el plan de vacunacién, queremos saber como ha evolucionado en el correr del tiempo (recordar que el plan de vacunación comenzó el 1ero de Marzo de 2021), si las mismas fueron efectivas, los diferentes tipos de laboratorios proveedores de vacunas y demás.

Para comenzar este análisis, nos preguntamos como ha ido avanzando dicho plan y cuanta cantidad de vacunas han sido suministradas por cada laboratorio.

```{r, echo=FALSE,warning=FALSE,message=FALSE, fig.align='center', fig.cap="Linea temporal mostrando la evolucion de cantidad de dosis de vacunas suministradas por dia segun laboratorio"}

### Pregunta 1 - ¿Cómo ha evolucionado la cantidad de dosis suministradas diariamente, comparando por laboratorio?

labs %>% ggplot(aes(x = date, y = diario, colour = lab)) + geom_line() + 
  scale_colour_brewer(palette = "Dark2") + scale_x_date(date_breaks = "10 days") + 
  theme(axis.text.x = element_text(size = 7, angle = 300, hjust = 0)) +
  labs(x = "Fecha",y = "Cantidad de dosis en el dia",colour = "Laboratorio")
```

En el gráfico se puede observar que en el Uruguay, solamente 3 laboratorios (hasta ahora) fueron los encargados de suministrarnos vacunas, los cuales son: Aztrazeneca, Pfizer y Sinovac.

Se observa con claridad que en la mayoría de los días tomados en cuenta para realizar el gráfico, se suministró más cantidad de dosis con la vacuna del laboratorio de origen chino Sinovac, comparando con los otros 2 laboratorios. 

Observando detalladamente el gráfico, se puede apreciar que los días en que más dosis se suministraron fueron entre los primeros 15 días del mes de Abril, período que incluyó la semana de turismo. En este lapso temporal se vacunó a población de un gran rango etario que iba desde los 18 años en adelante. Por otra parte, la vacuna elaborada por empresa farmacéutica de orígen estadounidense, Pfizer, tuvo su pico en torno al 10 de Abril, hecho que se explica por el comienzo del plan vacunatorio para gran parte de los trabajadores de la Salud ;con excepción de los que trabajan en áreas de mayor urgencia, como por ejemplo: block quirúrgico, servicios de apoyo CTI, y demás, que fueron vacunados en Marzo con Sinovac.

Respecto a la vacuna desarrollada por el laboratorio Astrazeneca con la Universidad de Oxford, que en primera instancia pretendía suministrarse a las franjas etarias mayores, a las personas no les pareció muy buena idea. Solamente a mediados de Abril fueron aplicadas cerca de 20000 dosis. Luego, las cifras fueron considerablemente menores, cuando en realidad existía mayor cantidad disponible. Esto puede deberse porque la vacuna de éste laboratorio llegó a Uruguay en un momento de dudas sobre sus efectos, al detectarse casos de trombosis tras su aplicación. Por su parte, el MSP (Ministerio de Salud Pública) y la comunidad científica internacional aseguran que los beneficios son mayores que los posibles riesgos.


Siguiendo la misma línea de análisis de la pregunta anterior, nos preguntamos por dicha cantidad, o sea, cuál fue la proporción de personas vacunadas por dicho laboratorio hasta el último día de registro de los datos (23/6). Los resultados son los siguientes:

```{r, echo=FALSE,warning=FALSE,message=FALSE, fig.align='center', fig.cap="Grafico de barras que representa la proporcion de dosis suministradas por laboratorio"}

### ¿Cuál es la proporción por laboratorio del total de dosis suministradas hasta el 23/06?

tabg <- labs %>% group_by(lab) %>% summarise(max_acum  = max(acum)) 

tabg %>% mutate(porc_acum = round(max_acum / sum(max_acum,na.rm = TRUE),2),
  uno = as.factor(rep(1,3))) %>% ggplot(aes(y = porc_acum, x = lab)) + 
  geom_bar(stat = "identity")  + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(y = "Porcentaje de dosis suministradas",x = "Laboratorio")
```

\pagebreak

Se observa que a lo largo del plan vacunatorio, la proveniente del laboratorio "Sinovac" ha sido adquirida en mayor cantidad por el Estado uruguayo. Además de haber sido provisto por el fondo COVAX; emparejado con esto, es la que se brindó en mayor magnitud, alrededor del 75% de las dosis.

También, se vacunó con ella a diversas poblaciones, empezando con los que desempeñaban alguna ocupación de riesgo y gran necesidad (bomberos, policias, personal de la educación), pasando por personas de distintas ocupaciones y edades.

Asimismo, en segundo lugar, la del laboratorio Pfizer se ha aplicado a poblaciones mas específicas como personal de salud y edades en las cuales aún no se habían realizado estudios con la china (Sinovac). Aproximadamente entre el 22% y 25% de las dosis suministradas fueron por Pfizer.

Por último, como se comentaba anteriormente, la vacuna Astrazeneca, además de haberse adquirido en menor proporción, también fue la más resistida. Tan solo cerca del 1% de las dosis que se suministraron en el territorio uruguayo provienen de este laboratorio.


### Primera y segunda dosis

En los medios de comunicación comentaron que gran cantidad de personas se ha dado la primera dosis de la vacuna pero no la segunda dosis, esto puede deberse por diferentes motivos (han tenido COVID y no podían vacunarse, desconfiaron luego de la primer dosis, etc). Por lo que nos pareció interesante investigar cuál fue la proporción de personas que se dieron la primer dosis hasta el 26/5 pero no la segunda.

```{r, echo=FALSE,warning=FALSE,message=FALSE, fig.align='center',fig.cap="Gráfico de barras mostrando la proporcion de personas vacunadas con primera dosis hasta el 26/05 y segunda dosis hasta el 23/06."}

### Pregunta 2 - Hasta el 23/06, ¿todas las personas con primera dosis antes del 26/05 recibieron la segunda dosis?. Si no es así, ¿Cuántas personas no se dieron la segunda dosis?

completas_pais_hasta_mayo<- uruguay %>% 
  select(date, total_vaccinations, people_vaccinated) %>%
  filter(date == "2021-05-26") 

completas_pais_hasta_junio<- uruguay %>% 
  select(date, total_vaccinations, people_fully_vaccinated) %>%
  filter(date == "2021-06-23") 

completas_pais<-merge(x=completas_pais_hasta_mayo, y=completas_pais_hasta_junio, all=TRUE) %>% 
  pivot_longer(cols = c("people_vaccinated","people_fully_vaccinated"),
               names_to = "Numero_dosis", 
               values_to ="Cant_dosis") %>% 
  group_by(Numero_dosis) %>% 
  summarise(Cant_dosis = sum(Cant_dosis, na.rm=TRUE)) %>% 
  group_by(Numero_dosis, Cant_dosis) %>% 
  summarise(porcentaje=round(Cant_dosis/1688019*100, 2))

completas_pais %>% 
  ggplot(aes(x=Numero_dosis, y=porcentaje))+
  geom_col()+ theme(aspect.ratio = 2)+
  scale_fill_brewer(labels=c('people_fully_vaccinated'='2 dosis',
                                                'people_vaccinated'='1 dosis'))+
  scale_x_discrete(labels=c('people_fully_vaccinated'='2 dosis',
                            'people_vaccinated'='1 dosis'))+
  labs(x="Dosis por persona", y="Cantidad de dosis")+
  geom_text(aes(x=Numero_dosis, label =paste(porcentaje, '%'), vjust = -0.05))+
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12), 
        plot.caption=element_text(hjust = 0.5))
```


Se puede observar que toda la población (que se agendó para vacunarse, no a nivel país) se encuentra vacunada, mientras que más del 85% de la población se dió la 2da dosis.

Un dato importante que se puede ver en dicho gráfico es que de todas las personas que se vacunaron con una dosis hasta el 26/05/2021, solamente un 13,6% no se dieron la segunda dosis a los 28 días.



**¿Y si analizamos a nivel país?**

```{r, echo=FALSE, warning=FALSE,message=FALSE, fig.align='center',fig.cap="Gráfico de barras mostrando la cantidad de personas vacunadas con primera dosis hasta el 26/05 y segunda dosis hasta el 23/06 a nivel pais"}

completas_pais %>% 
  ggplot(aes(x=Numero_dosis, y=Cant_dosis))+
  geom_col()+ theme(aspect.ratio = 2)+
  scale_fill_brewer( labels=c('people_fully_vaccinated'='2 dosis',
                                                'people_vaccinated'='1 dosis'))+
  scale_x_discrete(labels=c('people_fully_vaccinated'='2 dosis',
                            'people_vaccinated'='1 dosis'))+
  labs(x="Dosis por persona", y="Cantidad de dosis")+
  geom_text(aes(x=Numero_dosis, label =paste(Cant_dosis), vjust = -0.1, face = "bold"))

```

Se puede apreciar que 1688019 - 1458403 = 229616 personas aún no tienen la 2da dosis de la vacuna en el Uruguay. Cabe destacar que más de 200.000  personas fueron las que aún no decidieron vacunarse, ya que (como mencionamos anteriormente), no creen en la efectividad de la vacuna, no suelen vacunarse, pueden haber tenido covid en ese lapso de tiempo y no han podido inocularse, entre otras. 

Ésta última cantidad de personas proviene de sumar ambos valores del grafico y restárselo a la población de Uruguay (más de 3.300.000 de personas)

\pagebreak

Por otra parte, sabemos que Montevideo y Canelones son los departamentos con mayor población de Uruguay, por lo que sería 'evidente' decir que son los lugares con mayor cantidad de vacunados. De todos modos, la vacunación en el territorio viene siendo relativamente pareja en todos los departamentos, con alguna excepción.

Por ende, decimos analizar en el siguiente diagrama de barras, si realmente la relación vacuna/población es relativamente proporcional en éstos departamentos (Montevideo y Canelones).

```{r,echo=FALSE,warning=FALSE,message=FALSE, fig.align='center',fig.cap="Grafico de barras mostrando la proporcion de vacunados segun departamento"}

### Pregunta 3 - ¿Se podría decir que en los departamentos más poblados, como Montevideo y Canelones el porcentaje de vacunados es mayor?

departamentos<-departamentos %>% rename(Fully_Vaccinated='Fully Vaccinated')
departamentos %>% select(Region, Population, Fully_Vaccinated) %>% 
  mutate(proporcion=(Fully_Vaccinated)/Population) %>% arrange(desc(proporcion)) %>% 
  ggplot(aes(reorder(Region, proporcion), proporcion)) + 
  geom_bar(stat='identity')+coord_flip() + 
  labs(x='Departamentos', y='Proporción de personas vacunadas con ambas dosis') 

```

Se puede apreciar que no se cumple lo que planteamos anteriormente. Los 3 departamentos con mayor proporción de personas vacunadas con ambas dosis son: Durazno, Lavalleja y Flores.

Canelones, es el departamento con menor porcentaje de vacunados, debido a diferentes causas de organización al comienzo de dicho plan (por lo que se mecionó en las noticias).

Con respecto a Montevideo, se puede notar que, la relación vacuna/población viene a buen ritmo, encontrándose en un índice medio comparado con los demás departamentos. Montevideo tiene una población aproximada de 1.400.000 de personas, por lo que a pesar de que nuestro sistema de salud es muy eficiente, es más dificil coordinar y ejecutar el plan vacunatorio. 

También, cabe destacar que en este último tiempo, se están vacunando a los adolescentes entre 12 y 17 años que generalmente son el factor de contagio más probable, por lo que empezará a aumentar la proporción en todo el país, hasta lograr (lo que se dice) una inmunidad de rebaño (70% de la población vacunada)

\pagebreak

### Evolución de la pandemia


Sabemos que en el año 2020, el COVID-19 ha afectado de manera muy diferente a todos los departamentos, habiendo algunos casi sin casos o muy pocos, y centralizándose la mayor cantidad en la capital y alrededores (Montevideo y Canelones) y además en algunos departamentos del norte del país (Salto, Rivera).

Esto cambio rotundamente en el 2021, ya que a partir de ahi comenzó a haber un excesivo aumento de casos, ya sea por el verano y la gente empezó a salir con mayor frecuencia por lo que se 'cuidó' menos, no hubo un gran manejo de la pandemia, o simplemtente, al ser un virus tan contagioso y con la aparicón de nuevas cepas (Alpha, Beta, Gamma, Delta), el mismo mutó y desencadenó en una gran cantidad de contagios.

###### **Recordatorio** Como mencionamos al principio del informe, solamente vamos a analizar los datos a partir del tercer mes del año, hasta mediados de Junio. 

Por lo que nos pareció interesante plasmar en el siguiente gráfico, como ha crecido (o disminuido) los contagios en los departamentos de Uruguay. Para poder ver de forma más detallada el aumento de casos, y reducir a un rango más manejable los datos, dicho gráfico lo realizamos en escala logarítimica.


```{r, echo=FALSE, warning=FALSE,message=FALSE,fig.align='center',fig.cap="Linea temporal mostrando la evolucion de casos positivos separado por departamento, y aplicando escala logaritmica"}

### Pregunta 4 - ¿Cómo fue la evolución de casos positivos dependiendo del departamento?

por_depto$fecha = as.Date(por_depto$fecha, format = "%d/%m/%Y")
por_depto <- por_depto %>% mutate(departamento = recode(departamento, 
  'Artigas(UY-AR)'='Artigas', 'Canelones(UY-CA)'='Canelones',
  'Cerro Largo(UY-CL)'='Cerro Largo', 'Colonia(UY-CO)'='Colonia',
  'Durazno(UY-DU)'='Durazno','Flores(UY-FS)'='Flores','Florida(UY-FD)'='Florida',
  'Lavalleja(UY-LA)'='Lavalleja', 'Maldonado(UY-MA)'='Maldonado',
  'Montevideo(UY-MO)'='Montevideo','Paysandú(UY-PA)'='Paysandu', 
  'Río Negro(UY-RN)'='Rio Negro','Rivera(UY-RV)'='Rivera','Rocha(UY-RO)'='Rocha',
  'Salto(UY-SA)'='Salto','San José(UY-SJ)'='San José','Soriano(UY-SO)'='Soriano',
  'Tacuarembó(UY-TA)'='Tacuarembo', 'Treinta y Tres(UY-TT)'='Treinta y Tres'))

por_depto %>% ggplot(aes(x = fecha, y = cantCasosNuevosCALC)) + 
  geom_line(size = 0.05) + scale_x_date(date_breaks = "90 days") + 
  theme(axis.text.x = element_text(size = 7, angle = 300, hjust = 0),legend.position = 'none') +
  labs(x = "Fecha",y = "Cantidad de casos positivos",colour = "Departamento") + 
  facet_wrap(~departamento) + scale_y_log10()
```

\pagebreak

Practicamente en todo el territorio uruguayo hubo un aumento exponencial de casos positivos. En los departamentos que más se puede ver es en Montevideo, Salto y Paysandú.

Afortunadamente, desde Junio se puede notar un gran decrecimiento de casos positivos en todo el territorio, esto puede deberse al gran plan de vacunación que estamos teniendo (más de 4.000.000 de vacunadas proporcionadas).

A su vez, por lo que comentan las noticias, Rivera es el departamento que mejor está sobrellevando este último tiempo de la pandemia, y efectivamente viendo el gráfico, se puede concluir que es el que presenta el mayor decrecimiento de casos, encontrándose actualmente en color Amarillo en la escala de Harvard (único departamento en esa escala en todo el país)

### Fallecimientos

Desafortunadamente, y como era de esperarse, el virus ha dejado una gran cantidad de fallecidos en nuestra población, hecho que lamentamos mucho a nivel territorial y mundial. En el siguiente gráfico se aprecia la cantidad de fallecimientos por departamentos.


```{r, echo=FALSE,warning=FALSE,message=FALSE, fig.align='center',fig.cap="Grafico de barras ordenado mostrando la cantidad de fallecimientos por COVID-19 segun departamento"}

### ¿Y si vemos cuántas personas han fallecido por departamento?
por_depto %>% group_by(departamento) %>% 
  summarise(cantidad_fallecidos = sum(cantFallecidos, na.rm = TRUE)) %>%
  ggplot(aes(y=reorder(departamento,-cantidad_fallecidos, na.rm=TRUE), 
          x = cantidad_fallecidos)) + 
  geom_col() + theme(aspect.ratio = 1) +
  labs(x = "Cantidad de fallecidos",y = "Departamentos")
```

Se puede ver en el gráfico que los 2 departamentos que mayor población tienen en todo el país (Montevideo y Canelones) son los que tienen mayor cantidad de fallecidos.


Por otra parte, Flores, que es el que departamento que menor población tiene (un poco más de 24000 personas) es el departamento que tiene menor cantidad, ya que como mencionamos anteriormente, es el lugar que tiene menor población del Uruguay por lo que la cantidad de fallecimientos y contagios condice con su población.

\pagebreak

Haciendo un análisis en conjunto de el plan de vacunación y la cantidad de fallecimientos, nos interesa saber si la cantidad de fallecimientos ha disminuido con el suministro de vacunas.

```{r,echo = FALSE,warning=FALSE,message=FALSE}

### Pregunta 5 - ¿Se podría decir que la cantidad de fallecidos diarios ha disminuido a medida que avanza el plan de vacunación?

muertes_diarias <- muertes_edad %>% group_by(date) %>% 
  summarise(muertes_totales_diarias=sum(daily))

personas_totalmente_vacunadas <- uruguay %>% select(date, people_fully_vaccinated)
muertes_vacunados <- merge(muertes_diarias, personas_totalmente_vacunadas)

```

Primero que nada, veamos cómo se comportan las variables independientemente, o sea, como ha sido la evolución de la cantidad de personas vacunadas con segunda dosis. 

```{r, echo = FALSE,warning=FALSE,message=FALSE,fig.align='center',fig.cap='Gráfico temporal que muestra la evolución de la cantidad de personas vacunadas con ambas dosis.'}

ggplot(data=muertes_vacunados)+geom_line(aes(x=date, y=people_fully_vaccinated)) + 
  labs(x='Fecha', y='Personas vacunadas con ambas dosis')+
  scale_x_date(date_breaks = "15 days") +
  theme(axis.text.x = element_text(size = 9, angle = 300, hjust = 0))

```

Se puede ver que crece de forma aparentemente exponencial. Desde mediados de mayo hasta junio, se podría observar un pequeño estancamiento. Luego, si queremos analizar la cantidad de fallecidos a los largo de los días en dicho perído de analáisis, realizaremos otra línea temporal mostrando las diferentes cantidades de decesos que tuvo esta pandemia.

```{r,echo = FALSE,warning=FALSE,message=FALSE, fig.cap='Gráfico temporal que muestra la evolución en la cantidad de fallecidos diarios.'}
ggplot(data=muertes_vacunados,aes(x=date, y=muertes_totales_diarias))+geom_line() +
  labs(x='Fecha', y='Cantidad de fallecidos por día')+ 
   stat_peaks(span = NULL, color = "red") +
  stat_peaks(span = NULL, geom = "text", vjust = 0.6,hjust=0.8, color = "red", 
             aes(label = paste(stat(y.label), "fallecidos,\n el día", stat(x.label))))+
  scale_x_date(date_breaks = "15 days") + 
  theme(axis.text.x = element_text(size = 9, angle = 300, hjust = 0))
```

Se podría observar cierta tendencia exponencial hasta mediados de abril, el mayor pico de fallecidos se presenta el día 19/06/2021 con 91 muertes.

\pagebreak

Finalmente, 'uniendo' estos dos gráficos, vemos como fue la evolución de fallecidos a medida que aumenta la cantidad de personas completamente vacunadas.

```{r,echo = FALSE,warning=FALSE,message=FALSE, fig.cap='Gráfico que muestra la evolución de fallecidos, a medida que aumenta la cantidad de personas completamente vacunadas.' }

library(ggspectra)

ggplot(data=muertes_vacunados,aes(x=people_fully_vaccinated, y=muertes_totales_diarias)) +
  geom_line()+ labs(x='Personas vacunadas con ambas dosis', 
                    y='Cantidad de fallecidos por día') +
  stat_wb_hbar(w.band = c(250000,1000000), size = 1.2,color='red') +
  stat_wb_mean(color='red',
               w.band =  c(250000,1000000),vjust = -3.5,  label.fmt  = "Mean = %.3g") +
  stat_wb_hbar(w.band = c(1000000,1500000), size = 1.2,color='red') +
  stat_wb_mean(label.fmt  = "Mean = %.3g",
               w.band =  c(1000000,1500000), vjust = -3, hjust=0.4,color='red') +
  scale_x_continuous(n.breaks =8)
```

Se nota que hasta las 250.000 personas vacunadas con ambas dosis, podemos ver una tendencia a aumentar la cantidad de fallecidos diarios. En promedio, desde los 250.000 hasta el 1.000.000 de personas completamente vacunadas, 57,9 personas fallecieron diariamente. 

Si bien hay dos picos de fallecidos desde el millón de personas vacunadas con ambas dosis, en promedio, dicha cantidad ha disminuido, cayendo a 45.4 personas fallecidas diariamente.


\pagebreak


